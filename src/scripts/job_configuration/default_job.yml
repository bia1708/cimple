- job:
    name: unjob
    project-type: pipeline
    sandbox: true
    properties:
      - inject:
          keep-system-variables: true
          properties-file: "/var/lib/jenkins/workspace/properties_file.props"
    dsl: |
        // script-text:
        //     !include-raw-verbatim: job.groovy
        pipeline {{
            agent any
            /* Define Pipeline Stages */
            stages {{
                stage('Set ENV') {{
                    steps {{
                        script {{
                            // Set environment variables
                            def props = readProperties  file:'/var/lib/jenkins/workspace/properties_file.props'
                            env.REPO= props['REPO']
                        }}
                    }}
                }}
                stage('Checkout HDL and GHDL repositories') {{
                    steps {{
                        checkout([
                            $class: 'GitSCM', branches: [[name: '*/main']],
                            extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: "${{WORKSPACE}}"],],
                            userRemoteConfigs: [[credentialsId: 'b589aa01-c47f-4168-8384-40a8156b77ac', url: "$REPO"]]
                        ])
                    }}
                }}
            }}
        }}

        // node {{
        //     stage("test") {{
        //         script {{
        //             sh 'pwd'
        //             def props = readProperties  file:'/var/lib/jenkins/workspace/properties_file.props'
        //             env.repo= props['REPO']
        //             sh 'echo ${{repo}}'
        //         }}
        //     }}
        // }}
